{
    "collab_server" : "",
    "contents" : "---\ntitle: \"problema3-ck4\"\nauthor: \"Maelson Marques de Lima\"\ndate: \"21 de maio de 2016\"\noutput: word_document\n---\n\n#FPCC2-p2-c2\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nlibrary(dplyr)\nlibrary(stringi)\nlibrary(ggplot2)\nlibrary(GGally)\n\ntheme_set(theme_bw())\n```\n## ORGANIZANDO OS DADOS:\n\nDescrição da atividade:\n\n      Escolha 2 das perguntas que você listou e construa o relatório final deste problema respondendo-as utilizando as ferramentas visuais e numéricas de análise descritiva e exploratória que você preferir. A partir dos resultados dessas 2 perguntas iniciais, derive mais duas e as responda. \n      \n      Inicialmente a organização dos dados:\n\n```{r bds, message=FALSE, warning=FALSE, results='asis', echo=TRUE}\n\n#Tabela mpvies\nmovies <- read.csv(\"~/Rprojetos/Rprojects-fpcc2/bd-movies/movies.csv\")\n#View(movies)\n\n#Tabela ratings\nratings <- read.csv(\"~/Rprojetos/Rprojects-fpcc2/bd-movies/ratings.csv\")\n\n#Dados Um --Base 01\nmovies_join_ratings = merge(x = movies, y = ratings, by = \"movieId\", all.y = TRUE)\n#View(movies_join_ratings)\n\n#Dados Dois --Base 02 (Filmes Brasileiros Lançados - 1995 a 2014)\nfilmes_tratados<-read.csv(\"~/Rprojetos/Rprojects-fpcc2/bd-movies/filmes_tratados.csv\")\n#View(filmes_tratados)\n\n\n##knitr::kable(filmes_tratados[1:10, 1:11], caption = \"Amostra de Filmes Tratados:\")\n\n#Dados Três --BAse 03\nratings_filme<- read.csv(\"~/Rprojetos/Rprojects-fpcc2/bd-movies/ratings-por-filme.csv\") \n#View(ratings_filme)\n\n\n\n\n```\n\n**Minhas Perguntas**\n\n    **Analisando a base de dados de filmes brasileiros, surgiram alguns questionamentos, inicialmente estes 2:**\n    \n     \n     1. Qual gênero de filmes brasileiros gostam mais?\n     \n     2. Qual gênero de filmes são mais rentáveis?\n     \n     3. A média de público dos estados Nordestinos é maior que a de outras regiões?\n     \n     4. Nos anos que houve decréscimo na produção de filmes, quais as estimativas?\n     \n     \n##Respondendo questão 01:\n  **1. Qual gênero de filmes brasileiros gostam mais?**\n\n```{r q01, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n##Inicilamente vamos entender a o atributo Gênero da Tabela de filmes tratados:\n\ntable(filmes_tratados$Genero)\n\n#Obtemos valores que podem atrapalhar na análise, pois a quantidade de filmes dos gêneros Animação e videomusical são muito baixos. mas Vídeos de animação tem valores altos de renda e público.Sendo assim, será removido apenas o gênero Videomusical.\n\n\n#filtro para remover estes gêneros:\n\n\nfilmes_tratados<-filter(filmes_tratados,Genero!='Videomusical')\n\n#Agora limitar as informações com as quais irei tratar: Gênero e Publico e remover outliers(publico >=1000 ). Acredito que faça mais sentido, trabalhar com filmes que tiveram um público considerável.\n\n#names(filmes_tratados)\n\nft1<-filmes_tratados[, c(3,8,11)]#Titulo, Genero e Publico\n\n#transforma caracteres\nft1$Publico<-as.character(ft1$Publico)\n#estatística descritiva sobre a tabela agrupada:\n#View(ft1)\n\nponto<-'\\\\.'\n\nfor(i in 1:length(ft1$Publico)){\n  ft1[i,3]<-gsub(ponto,\"\",ft1[i,3])}\n\n\n\n#transforma numérico\nft1$Publico<-as.numeric(ft1$Publico)\n\nft1<-filter(ft1, ft1$Publico>1000)#miores que 1mil espectadores\n\n\n\n\n```\n\n\n    **Bootstrap:**\n\n```{r prob, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\nMedias_ft1<-ft1%>%group_by(Genero)%>%summarise(mediap=mean(Publico), medianap=median(Publico))\n\n#Observem que os valores são bem próximos\nknitr::kable(Medias_ft1, caption = \"Média e Mediana da população\")\n\n#Como podemos observar, Documentários tem uma média e Mediana muito baixa, sendo assim, executremos o IC apenas em Animações e Ficção. Além disso, existe uma dispareidade muito alta entre a média e a mediana. o que indica uma variância muito alta nestes valores, assim, é preferível tratar com a mediana.\n\n#Animação - Ficção (Mediana) -- ANIMAÇÃO > FICÇÃO\ndif_mediana_31 = Medias_ft1[1,3] - Medias_ft1[3,3]\nprint(paste(\"Diferença na mediana observada:\", round(dif_mediana_31),\".Seria Melhor animação\"))\n\n#Ficção - Animação (Média) -- FICÇÃO > ANIMAÇÃO\ndif_media_31=Medias_ft1[3,2]-Medias_ft1[1,2]\nprint(paste(\"Diferença na media observada:\", round(dif_media_31), \".Seria Melhor Ficção\"))\n\n\n\nft1_31<-filter(ft1, Genero=='Animação'| Genero==\"Ficção\")\n\n# Retorna a diferença nas médias entre o grupos de y\n# nos índices com valor de x igual a baseline após embaralhar x.\nrepete_experimento_de_diff = function(x, y, baseline){\n  embaralhado = x[sample(NROW(x))]\n  baseline_mean = mean(y[which(embaralhado == baseline)])\n  other_mean = mean(y[which(embaralhado != baseline)])\n  return(other_mean - baseline_mean)\n}\n\n\n#EXPERIMENTO  FICÇÃO > ANIMAÇÃO\n\nnum_experimentos = 1000#Rodando mil vezes\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = repete_experimento_de_diff(ft1_31$Genero, ft1_31$Publico, \"Ficção\"))\n\n#Demora um absurdo!!!\nggplot(experimentos, aes(x = diferenca/1e3)) + \n geom_histogram(binwidth = 100, colour = \"darkblue\", fill = \"white\") \n#Tive que adicionar um valor alto para o binwith, as diferenças de valores variam muito em alguns casos.\n\nsummary(experimentos)\n\nquantas_aconteceram = length(which(experimentos$diferenca >= dif_media_31$mediap))\nprobabilidade = quantas_aconteceram / num_experimentos\n\nprint(paste(\"Este Evento ocorreu: \",quantas_aconteceram,\"vezes\" ))\nprint(paste(\"A probabilidade de ocorrência é de: \",probabilidade))\n\n\n\n#EXPERIMENTO aNIMAÇÃO > FICÇÃO -MEDIANA\n\nrepete_experimento_de_diff = function(x, y, baseline){\n  embaralhado = x[sample(NROW(x))]\n  baseline_median = median(y[which(embaralhado == baseline)])\n  other_median = median(y[which(embaralhado != baseline)])\n  return(other_median - baseline_median)\n}\n\nnum_experimentos = 1000#Rodando 100\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = repete_experimento_de_diff(ft1_31$Genero, ft1_31$Publico, \"Animação\"))\n\n#Demora um absurdo!!!\nggplot(experimentos, aes(x = diferenca/1e3)) + \n geom_histogram(binwidth = 100, colour = \"darkblue\", fill = \"white\")\n\nsummary(experimentos)\n\nquantas_aconteceram = length(which(experimentos$diferenca >= dif_mediana_31$medianap))\nprobabilidade = quantas_aconteceram / num_experimentos\n\nprint(paste(\"Este Evento ocorreu: \",quantas_aconteceram,\"vezes\" ))\nprint(paste(\"A probabilidade de ocorrência é de: \",probabilidade))\n\n\n\n```\n\n\n\n###Garantir o IC:\n\n\n\n```{r gic,echo=TRUE, message=FALSE, warning=FALSE, results='asis' }\n\n#BOOTSTRAPPING IC FICÇÃO > ANIMAÇÃO --MÉDIA\n\nrepeticoes = 1000 # Experimento com 1000 reptições\n\n#Gerando os valores para o bootrap para MÉDIA EM QUE FICÇÃO > ANIMAÇÃO\nexp_com_bootstrap <- function(x, y){\n  boot_x <- sample(x, size = NROW(x), replace = TRUE) # aqui é o bootstrap\n  boot_y <- sample(y, size = NROW(y), replace = TRUE) # de novo!\n  return(mean(boot_x) - mean(boot_y))\n}\n\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = exp_com_bootstrap(ft1_31[ft1_31$Genero==\"Ficção\",]$Publico,ft1_31[ft1_31$Genero==\"Animação\",]$Publico ))\n\n\n\nggplot(experimentos, aes(x = diferenca/1e3)) + \n  geom_histogram(binwidth = 100, colour = \"darkorange\", fill = \"white\")\nsummary(experimentos)\n\n# IC com 90%: \n#\"Portanto em 90% com (margem +-0.5) das repetições os  ficaram entre:  \"\nalpha = .1\n\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n# IC com 95%:\n#Portanto em 95% das repetições, com margem de +-2,5  os valores p ficaram entre:\nalpha = .05\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n\n##BOOTSTRAPPING IC ANIMAÇÃO > FICAÇÃO --MEDIANA\nrepeticoes = 1000 # Experimento com 1000 reptições\n\n#Gerando os valores para o bootrap para MÉDIA EM QUE FICÇÃO > ANIMAÇÃO\nexp_com_bootstrap <- function(x, y){\n  boot_x <- sample(x, size = NROW(x), replace = TRUE) # aqui é o bootstrap\n  boot_y <- sample(y, size = NROW(y), replace = TRUE) # de novo!\n  return(median(boot_x) - median(boot_y))\n}\n\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = exp_com_bootstrap(ft1_31[ft1_31$Genero==\"Animação\",]$Publico,ft1_31[ft1_31$Genero==\"Ficção\",]$Publico ))\n\n\n\nggplot(experimentos, aes(x = diferenca/1e3)) + \n  geom_histogram(binwidth = 100, colour = \"darkorange\", fill = \"white\")\nsummary(experimentos)\n\n# IC com 90%: \n#\"Portanto em 90% com (margem +-0.5) das repetições os  ficaram entre:  \"\nalpha = .1\n\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n# IC com 95%:\n#Portanto em 95% das repetições, com margem de +-2,5  os valores p ficaram entre:\nalpha = .05\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n```\n  \n  **Portanto, é possível dizer, que As pessoas gostam mais de filmes de Animação no brasil.**\n\n\n##Respondendo questão 02:\n\n  **2. Qual gênero de filmes são mais rentáveis?**\n  \n  \n**Tratamento**\n\n```{r q02, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n#Agora limitar as informações com as quais irei tratar: Gênero e Renda e remover outliers(Renda >1000 ). Acredito que faça mais sentido, trabalhar com filmes que tiveram um Renda considerável.\n\n#names(filmes_tratados)\n\nft2<-filmes_tratados[, c(3,8,10)]#Titulo, Genero e Renda\n\n\n#transforma caracteres\nft2$Renda<-as.character(ft2$Renda)\n#estatística descritiva sobre a tabela agrupada:\n#View(ft2)\n\nponto<-'\\\\.'\n\nfor(i in 1:length(ft2$Renda)){\n  ft2[i,3]<-gsub(ponto,\"\",ft2[i,3])}\n\nvirg<-'\\\\,'\n\nfor(i in 1:length(ft2$Renda)){\n  ft2[i,3]<-gsub(virg,\".\",ft2[i,3])}\n\n#transforma numérico\nft2$Renda<-as.numeric(ft2$Renda)\n#Pega apenas quem rendeu mais de mil reais.\n\nft2<-filter(ft2, ft2$Renda>1000)#\nft2$Renda<-round(ft2$Renda)\n\nmedia_ft2<-ft2%>%group_by(Genero)%>%summarise(mediar=mean(Renda),medianar=median(Renda))\n\n# E novamente observamos uma diferença entre os valores de Média e Mediana em relação à Animação e Ficção, com Documentário ficando para trás.\n\nknitr::kable(media_ft2, caption = \"Média e Mediana da Renda\")\n\n\n\n\n\n```\n\n  **Iniciamos aqui as repetições para um probabilidade de ocorrências e depois um bootstrapping.**\n  \n\n```{r prob2, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n\n#Como podemos observar, Documentários tem uma média e Mediana muito baixa, sendo assim, executremos o IC apenas em Animações e Ficção. Além disso, existe uma dispareidade muito alta entre a média e a mediana. o que indica uma variância muito alta nestes valores.\n\n#Animação - Ficção (Mediana)\ndif_mediana_31 = media_ft2[1,3] - media_ft2[3,3]\n\n#Ficção - Animação (Média)\ndif_media_31=media_ft2[3,2]-media_ft2[1,2]\n#View(dif_mediana_31)\n#View(dif_media_31)\n\nprint(paste(\"Diferença na mediana observada:\", round(dif_mediana_31),\".Seria Melhor animação\"))\n\nprint(paste(\"Diferença na media observada:\", round(dif_media_31), \"Seria Melhor Ficção\"))\n\n\n\nft2_31<-filter(ft2, Genero=='Animação'| Genero==\"Ficção\")\n\n# Retorna a diferença nas médias entre o grupos de y\n# nos índices com valor de x igual a baseline após embaralhar x.\nrepete_experimento_de_diff = function(x, y, baseline){\n  embaralhado = x[sample(NROW(x))]\n  baseline_mean = mean(y[which(embaralhado == baseline)])\n  other_mean = mean(y[which(embaralhado != baseline)])\n  return(other_mean - baseline_mean)\n}\n\n\n#O  experimento medindo as média para Ficção\n\nnum_experimentos = 1000#Rodando mil vezes\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = repete_experimento_de_diff(ft2_31$Genero, ft2_31$Renda, \"Ficção\"))\n\n#Demora um absurdo!!!\nggplot(experimentos, aes(x = diferenca/1e4)) + \n geom_histogram(binwidth = 100, colour = \"darkblue\", fill = \"white\") \n#Tive que adicionar um valor alto para o binwith, as diferenças de valores variam muito em alguns casos.\n\nsummary(experimentos)\n\nquantas_aconteceram = length(which(experimentos$diferenca >= dif_media_31$mediar))\nprobabilidade = quantas_aconteceram / num_experimentos\n\nprint(paste(\"Este Evento ocorreu: \",quantas_aconteceram,\"vezes\" ))\nprint(paste(\"A probabilidade de ocorrência é de: \",probabilidade))\n\n\n\n#####\n\n#O mesmo experimento para mediana em relação à Animação\n\nrepete_experimento_de_diff = function(x, y, baseline){\n  embaralhado = x[sample(NROW(x))]\n  baseline_median = median(y[which(embaralhado == baseline)])\n  other_median = median(y[which(embaralhado != baseline)])\n  return(other_median - baseline_median)\n}\n\nnum_experimentos = 1000#Rodando 100\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = repete_experimento_de_diff(ft2_31$Genero, ft2_31$Renda, \"Animação\"))\n\n#Demora um absurdo!!!\nggplot(experimentos, aes(x = diferenca/1e3)) + \n geom_histogram(binwidth = 100, colour = \"darkblue\", fill = \"white\")\n\nsummary(experimentos)\n\nquantas_aconteceram = length(which(experimentos$diferenca >= dif_mediana_31$medianar))\nprobabilidade = quantas_aconteceram / num_experimentos\n\nprint(paste(\"Este Evento ocorreu: \",quantas_aconteceram,\"vezes\" ))\nprint(paste(\"A probabilidade de ocorrência é de: \",probabilidade))\n\n\n\n```\n\n    **De acordo com os valores obtidos, podemos dizer que filmes de ficção tem maior rentabilidade do que filmes de animação.**\n\n\n###Garantir o IC:\n\n\n```{r gic2,echo=TRUE, message=FALSE, warning=FALSE, results='asis' }\n\n##Intervalo de confiança para Animação > Ficção --MEDIANA\n\nrepeticoes = 1000 # Experimento com 1000 reptições\n\n#Gerando os valores para o bootrap\nexp_com_bootstrap <- function(x, y){\n  boot_x <- sample(x, size = NROW(x), replace = TRUE) # aqui é o bootstrap\n  boot_y <- sample(y, size = NROW(y), replace = TRUE) # de novo!\n  return(median(boot_x) - median(boot_y))\n}\n\n\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = exp_com_bootstrap(ft2_31[ft2_31$Genero==\"Animação\",]$Renda,ft2_31[ft2_31$Genero==\"Ficção\",]$Renda ))\n\n\n\nggplot(experimentos, aes(x = diferenca/1e3)) + \n  geom_histogram(binwidth = 100, colour = \"darkorange\", fill = \"white\")\nsummary(experimentos)\n\n# IC com 90%: \n#\"Portanto em 90% com (margem +-0.5) das repetições os valores para esse genero (Animação) ficaram entre:  \"\nalpha = .1\n\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n# IC com 95%:\n#Portanto em 95% das repetições, com margem de +-2,5  os valores para esse gênero (Animação) ficaram entre:\nalpha = .05\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n\n\n###############\n\n\n\n##Intervalo de confiança para  Ficção > aNIMAÇÃO  --MÉDIA\nrepeticoes = 1000 # Experimento com 1000 reptições\n\n#Gerenaod os valores para o bootrap\nexp_com_bootstrap <- function(x, y){\n  boot_x <- sample(x, size = NROW(x), replace = TRUE) # aqui é o bootstrap\n  boot_y <- sample(y, size = NROW(y), replace = TRUE) # de novo!\n  return(mean(boot_x) - mean(boot_y))\n}\n\n\n\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = exp_com_bootstrap(ft2_31[ft2_31$Genero==\"Ficção\",]$Renda,ft2_31[ft2_31$Genero==\"Animação\",]$Renda ))\n\n\n\nggplot(experimentos, aes(x = diferenca/1e3)) + \n  geom_histogram(binwidth = 100, colour = \"darkorange\", fill = \"white\")\nsummary(experimentos)\n\n# IC com 90%: \n#\"Portanto em 90% com (margem +-0.5) das repetições as médias ficaram entre:  \"\nalpha = .1\n\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n# IC com 95%:\n#Portanto em 95% das repetições, com margem de +-2,5  as médias ficaram entre:\nalpha = .05\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n\n\n```\n\n\n\n##QUESTÃO 3\n\n 3. A média de público dos estados Nordestinos é maior que a de outras regiões?\n \n \n \n```{r q03}\n\n \n\nfilmes_tratados<-filter(filmes_tratados,Genero!='Videomusical')\n\n#Agora limitar as informações com as quais irei tratar: Estado e Público e remover outliers(publico >1000 ). Acredito que faça mais sentido, trabalhar com filmes que tiveram um público considerável.\n\n \n\nft3<-filmes_tratados[, c(3,6,11)]#Titulo, Genero e Publico\n\nView(ft3)\n#transforma caracteres\nft3$Publico<-as.character(ft3$Publico)\n#estatística descritiva sobre a tabela agrupada:\n#View(ft1)\n\nponto<-'\\\\.'\n\nfor(i in 1:length(ft3$Publico)){\n  ft3[i,3]<-gsub(ponto,\"\",ft3[i,3])}\n\n\n\n#transforma numérico\nft3$Publico<-as.numeric(ft3$Publico)\n\nft3<-filter(ft3, ft3$Publico>1000)#miores que 1mil espectadores\n\n#\nmedias_ft3<-ft3%>%group_by(UF)%>%summarise(mediap=mean(Publico), medianap=median(Publico))\nmedias_ft3<-filter(medias_ft3, UF!='AM',UF!='MG / RJ' )#médias sem am e mg/rj\n#View(medias_ft3)\n\n#Observem que os valores são bem próximos\nknitr::kable(medias_ft3, caption = \"Média e Mediana da população\")\n\n#agora agupamento para receber as médias de cada região:\n\n#nordeste\ndf1<-filter(ft3,UF=='BA'|UF=='PE'|UF=='CE'|UF=='SE'|UF=='MA')%>%summarise(Regiao='NORDESTE',somaP=sum(Publico),mediaP=mean(Publico))\n\n\n#sudeste\ndf2<-filter(ft3,UF=='SP'|UF=='RJ'|UF=='MG'|UF=='ES')%>%summarise(Regiao='SUDESTE',somaP=sum(Publico),mediaP=mean(Publico))\n\n#sul\ndf3<-filter(ft3,UF=='SC'|UF=='RS'|UF=='PR')%>%summarise(Regiao='SUL',somaP=sum(Publico),mediaP=mean(Publico))\n\nMedia_regiao<-df1\nMedia_regiao<-rbind(Media_regiao,df2)\nMedia_regiao<-rbind(Media_regiao,df3)\n\n#As médias da região sudeste são muito altas, o que já responderia a questão inicial,\nknitr::kable(Media_regiao, caption = \"Média e Mediana da população\")\n\n```\n\n    Como as médias das regiões sudeste já se mostram muito superiores às das outras regiões, Farei um pouco diferente e irei comparar apenas entre os estados do SP e CE que se mostram mais parecidos em suas médias, mas tem dispareidade nas medianas.\n    \n    \n```{r cesp, message=FALSE, warning=FALSE, results='asis', echo=TRUE}\n\n  #filtro para CE e SP\n  ft3<-filter(ft3, UF==\"CE\" | UF==\"SP\")\n  #View(novo_ft3)\n\n#Agrupando as médias de ft3\nmedias_ft3<-ft3%>%group_by(UF)%>%summarise(mediap=mean(Publico), medianap=median(Publico))\n  #View(medias_ft3)\n\n#Existem diferença entre as medianas e médias dos estados: \n\n#Ceará > São paulo--média\ndif_media_12=medias_ft3[1,2]-medias_ft3[2,2]\nprint(paste(\"Diferença na media observada:\", round(dif_media_12), \".Seria Melhor Ceará\"))\n\n\n#São paulo> ceará -- mediana\ndif_mediana_21 = medias_ft3[2,3] - medias_ft3[1,3]\nprint(paste(\"Diferença na mediana observada:\", round(dif_mediana_21),\".Seria Melhor São paulo\"))\n\n\n```\n\n\n  **Iniciando as probabilidades**\n  \n  \n **O  experimento medindo as médias CE**\n  \n```{r prob3, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n\n\n# Retorna a diferença nas médias entre o grupos de y\n# nos índices com valor de x igual a baseline após embaralhar x.\nrepete_experimento_de_diff = function(x, y, baseline){\n  embaralhado = x[sample(NROW(x))]\n  baseline_mean = mean(y[which(embaralhado == baseline)])\n  other_mean = mean(y[which(embaralhado != baseline)])\n  return(other_mean - baseline_mean)\n}\n\n\n#O  experimento medindo as médias CE\n\nnum_experimentos = 1000#Rodando mil vezes\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = repete_experimento_de_diff(ft3$UF, ft3$Publico, \"CE\"))\n\n#Demora um absurdo!!!\nggplot(experimentos, aes(x = diferenca/1e3)) + \n geom_histogram(binwidth =30 , colour = \"darkblue\", fill = \"white\") \n#Tive que adicionar um valor alto para o binwith, as diferenças de valores variam muito em alguns casos.\n\nsummary(experimentos)\n\nquantas_aconteceram = length(which(experimentos$diferenca >= dif_media_12$mediap))\nprobabilidade = quantas_aconteceram / num_experimentos\n\nprint(paste(\"Este Evento ocorreu: \",quantas_aconteceram,\"vezes\" ))\nprint(paste(\"A probabilidade de ocorrência é de: \",probabilidade))\n\n#De acordo com os valores obtidos, podemos dizer que filmes cearenses tem uma público maior do que filmes Paulistas de acordo com a Analisando a Média\n\n```\n\n\n**O  experimento medindo as médianas SP**\n\n```{r pob4, message=FALSE, warning=FALSE, results='asis', echo=TRUE}\n\n################################\n\n\n\n#O  experimento medindo as médianas SP\n\nrepete_experimento_de_diff = function(x, y, baseline){\n  embaralhado = x[sample(NROW(x))]\n  baseline_median = median(y[which(embaralhado == baseline)])\n  other_median = median(y[which(embaralhado != baseline)])\n  return(other_median - baseline_median)\n}\n\n\nnum_experimentos = 1000#Rodando mil vezes\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = repete_experimento_de_diff(ft3$UF, ft3$Publico, \"SP\"))\n\n#Demora um absurdo!!!\nggplot(experimentos, aes(x = diferenca/1e3)) + \n geom_histogram(binwidth =30 , colour = \"darkblue\", fill = \"white\") \n#Tive que adicionar um valor alto para o binwith, as diferenças de valores variam muito em alguns casos.\n\nsummary(experimentos)\n\nquantas_aconteceram = length(which(experimentos$diferenca >= dif_mediana_21$medianap))\nprobabilidade = quantas_aconteceram / num_experimentos\n\nprint(paste(\"Este Evento ocorreu: \",quantas_aconteceram,\"vezes\" ))\nprint(paste(\"A probabilidade de ocorrência é de: \",probabilidade))\n\n\n  #De acordo com os valores obtidos, podemos dizer que filmes Paulista tem uma público maior do que filmes Cearenses se analisarmos a Mediana.\n\n```\n\n\n\n##QUESTÃO 4\n     \n4. Nos anos que houve decréscimo na produção de filmes, quais as estimativas ou Qual o gênero mais assistido?\n\nSe observarmos curidadosamente as quantidades de lançamentos em cada ano, vamos perceber que em alguns anos houve decréscimo de lançamento. Acredito ser possível traçar um relacionamente entre alguns fatores de econômia, por exemplo. Mas no meu caso irei apenas demostrar quais os filmes que as pessoas preferiram nestes anos.\n\n\n```{r q5, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n\n#tabela com valores eplotagem\n\nx<-table(filmes_tratados$AnoLancamento)\n\nx<-as.data.frame(x)\n\nggplot(data = x,aes(x= x$Var1, y= x$Freq) )+geom_bar(stat = \"identity\")+ylab(\"Frequência\")+xlab(\"Ano\")+ggtitle(\"Gráfico barras: Ano X Frequência\" )\n\n\n#organizando dados\n\nft4<-filmes_tratados[, c(2,3,8,10,11)]#Titulo, Genero e Publico\n#View(ft4)\n\n#limpando e tratando os valores\n\nft4$Publico<-as.character(ft4$Publico)\n\n\n#remove pontos de Publico\nponto<-'\\\\.'\n\nfor(i in 1:length(ft4$Publico)){\n  ft4[i,5]<-gsub(ponto,\"\",ft4[i,5])}\n\nft4$Publico<-as.numeric(ft4$Publico)\n\n#remove pontos e virgulas de --renda\nft4$Renda<-as.character(ft4$Renda)\nponto<-'\\\\.'\n\nfor(i in 1:length(ft4$Renda)){\n  ft4[i,4]<-gsub(ponto,\"\",ft4[i,4])}\n\nvirg<-'\\\\,'\n\nfor(i in 1:length(ft4$Renda)){\n  ft4[i,4]<-gsub(virg,\".\",ft4[i,4])}\n\n#transforma numérico\nft4$Renda<-as.numeric(ft4$Renda)\n\n#Pega apenas quem rendeu mais de mil reaise teve mais de mil espectadores\n\nft4<-ft4[, c(1,3,4,5)]\nft4<-filter(ft4,Renda>1000, Publico>1000)\n\n\nmedia_ft4<-group_by(ft4,AnoLancamento)%>%summarise(mediaR=mean(Renda),mediaP=mean(Publico))\nView(media_ft4)\n\n knitr::kable(media_ft4, caption = \"Médias de Renda e Publico\")\n \n\n```\n\n  Irei trabalhar apenas com os anos em que houve diminuição da quantidade de filmes em relação ao seu ano anterior, neste caso são 06: 2000, 2002, 2005, 2010,2012, 2014.\n  \n```{r q6, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n  ft4<-filter(ft4, AnoLancamento=='2000'| AnoLancamento=='2002'|AnoLancamento=='2005'|AnoLancamento=='2010'|AnoLancamento=='2012'|AnoLancamento=='2014' )\n\n#Médias de Renda e Publico dos anos de decréscimo\nmedias_ft4<-group_by(ft4,AnoLancamento)%>%summarise(mediaR=mean(Renda),mediaP=mean(Publico))\n\nknitr::kable(medias_ft4, caption = \"Médias de Renda e Publico dos anos de decréscimo\")\n\n#Aqui é possível perceber que dentro desses anos os filmes de ficção ciêntífica tiveram tanto renda quando Público bem maior que os demais.\n\nmedias_ft4<-group_by(ft4, Genero)%>%summarise(mediaR=mean(Renda),mediaP=mean(Publico))\n#View(medias_ft4)\nknitr::kable(medias_ft4, caption = \"Médias de Renda e Publico dos anos dos gêneros\")\n\n#Como foram poucos filmes de Animação (apenas 06), irei retirálos do experimento, e agir em cima apenas de documentário e Ficção.\n\nft4<-filter(ft4,Genero!=\"Animação\")\n\n\n\n```\n\n\n  Agora veremos as estimativas de público e rendas em anos de decrescimo apenas para os gêneros Documentário e Ficção:\n  \n\n```{r q7, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n\nmedias_ft4<-group_by(ft4,AnoLancamento)%>%summarise(mediaR=mean(Renda),mediaP=mean(Publico))\n\nknitr::kable(medias_ft4, caption = \"Médias de Renda e Publico dos anos de decréscimo\")\n\n#Aqui é possível perceber que dentro desses anos os filmes de ficção ciêntífica tiveram tanto renda quando Público bem maior que os demais.\n\nmedias_ft4<-group_by(ft4, Genero)%>%summarise(mediaR=mean(Renda),mediaP=mean(Publico))\n#View(medias_ft4)\n\nmedias_ft4<-group_by(ft4, Genero)%>%summarise(mediaR=mean(Renda),mediaP=mean(Publico))\nknitr::kable(medias_ft4, caption = \"Médias de Renda e Publico dos anos dos gêneros\")\n\n\n\n#Ficção - Documentário Média Público\ndif_mediap_21 = medias_ft4[2,3] - medias_ft4[1,3]\nprint(paste(\"Diferença na mediana observada:\", round(dif_mediap_21),\".Seria Melhor Ficção\"))\n\n\n#Ficção - Documentário Média Renda\ndif_mediar_21=medias_ft4[2,2]-medias_ft4[1,2]\nprint(paste(\"Diferença na media observada:\", round(dif_mediar_21), \".Seria Melhor Ficção\"))\n\n\n\n\n```\n\n\n\n\n\n  **Iniciando as probabilidades**\n  \n  PROBABILIDADE PARA MÉDIAS DE PÚBLICO:\n  \n  \n```{r q8, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n\n\n# Retorna a diferença nas médias entre o grupos de y\n# nos índices com valor de x igual a baseline após embaralhar x.\n\nrepete_experimento_de_diff = function(x, y, baseline){\n  embaralhado = x[sample(NROW(x))]\n  baseline_mean = mean(y[which(embaralhado == baseline)])\n  other_mean = mean(y[which(embaralhado != baseline)])\n  return(other_mean - baseline_mean)\n}\n\n\n#O  experimento medindo as médias Ficção --PÚBLICO\n\nnum_experimentos = 1000#Rodando mil vezes\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = repete_experimento_de_diff(ft4$Genero, ft4$Publico, \"Ficção\"))\n\n#Demora um absurdo!!!\nggplot(experimentos, aes(x = diferenca/1e3)) + \n geom_histogram(binwidth =30 , colour = \"darkblue\", fill = \"white\") \n#Tive que adicionar um valor alto para o binwith, as diferenças de valores variam muito em alguns casos.\n\nsummary(experimentos)\n\nquantas_aconteceram = length(which(experimentos$diferenca >= dif_mediap_21$mediaP))\nprobabilidade = quantas_aconteceram / num_experimentos\n\nprint(paste(\"Este Evento ocorreu: \",quantas_aconteceram,\"vezes\" ))\nprint(paste(\"A probabilidade de ocorrência é de: \",probabilidade))\n\n #Neste experimento apenas uma houve apenas uma vez em que a diferença no experimento foi maior do que a média.\n#Portanto é centro que o valor do público de filmes de Ficção é meior que os de Documentários\n\n##########################\n\nrepete_experimento_de_diff = function(x, y, baseline){\n  embaralhado = x[sample(NROW(x))]\n  baseline_mean = mean(y[which(embaralhado == baseline)])\n  other_mean = mean(y[which(embaralhado != baseline)])\n  return(other_mean - baseline_mean)\n}\n\n\n#O  experimento medindo as médias Ficção --RENDA\n\nnum_experimentos = 1000#Rodando mil vezes\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = repete_experimento_de_diff(ft4$Genero, ft4$Renda, \"Ficção\"))\n\n#Demora um absurdo!!!\nggplot(experimentos, aes(x = diferenca/1e3)) + \n geom_histogram(binwidth =30 , colour = \"darkblue\", fill = \"white\") \n#Tive que adicionar um valor alto para o binwith, as diferenças de valores variam muito em alguns casos.\n\nsummary(experimentos)\n\nquantas_aconteceram = length(which(experimentos$diferenca >= dif_mediar_21$mediaR))\nprobabilidade = quantas_aconteceram / num_experimentos\n\nprint(paste(\"Este Evento ocorreu: \",quantas_aconteceram,\"vezes\" ))\nprint(paste(\"A probabilidade de ocorrência é de: \",probabilidade))\n\n #Neste experimento apenas não houve vez em que a diferença no experimento foi maior do que a média.\n#Portanto é certo que o valor da Renda de filmes de Ficção é meior que os de Documentários\n\n\n```\n\n\n**Medindo o IC:**\n\n\n```{r q9, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}\n\n\n##Intervalo de confiança para  Ficção > aNIMAÇÃO  --MÉDIA\nrepeticoes = 1000 # Experimento com 1000 reptições\n\n#Gerenaod os valores para o bootrap\nexp_com_bootstrap <- function(x, y){\n  boot_x <- sample(x, size = NROW(x), replace = TRUE) # aqui é o bootstrap\n  boot_y <- sample(y, size = NROW(y), replace = TRUE) # de novo!\n  return(mean(boot_x) - mean(boot_y))\n}\n\n\n\nexperimentos = data_frame(i = 1:num_experimentos)\nexperimentos = experimentos %>% \n  rowwise() %>% \n  mutate(diferenca = exp_com_bootstrap(ft4[ft4$Genero==\"Ficção\",]$Renda,ft4[ft4$Genero==\"Documentário\",]$Renda ))\n\n\n\nggplot(experimentos, aes(x = diferenca/1e3)) + \n  geom_histogram(binwidth = 100, colour = \"darkorange\", fill = \"white\")\nsummary(experimentos)\n\n# IC com 90%: \n#\"Portanto em 90% com (margem +-0.5) das repetições as médias ficaram entre:  \"\nalpha = .1\n\nquantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n\n# IC com 95%:\n#Portanto em 95% das repetições, com margem de +-2,5  as médias ficaram entre:\nalpha = .05\n\n  quantile(experimentos$diferenca, probs = c(alpha/2, 1 - alpha/2))\n  \n  \n  #Fim\n\n```\n\n",
    "created" : 1463884261491.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2700716760",
    "id" : "34E8FB48",
    "lastKnownWriteTime" : 1464034740,
    "last_content_update" : 1464034740123,
    "path" : "~/Rprojetos/Rprojects-fpcc2/p3ck4.Rmd",
    "project_path" : "p3ck4.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}